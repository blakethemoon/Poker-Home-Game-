<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Poker Chip AI</title>
</head>
<body>
  <h2>Poker Chip Counter</h2>
  <input type="file" accept="image/*" onchange="handleFile(event)" />
  <div id="chip-loading" style="display:none;">Scanning...</div>
  <pre id="result"></pre>

<script>
const DENOMS = [
  { id: 'r', name: 'red', value: 0.10 },
  { id: 'b', name: 'blue', value: 0.50 },
  { id: 'bl', name: 'black', value: 1.00 },
  { id: 'g', name: 'green', value: 5.00 }
];

function handleFile(e){
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = function(evt){
    runAI(evt.target.result);
  };
  reader.readAsDataURL(file);
}

function runAI(dataUrl) {

  const base64 = dataUrl.split(",")[1];

  const chipValues = DENOMS
    .map(d => d.name.toUpperCase() + "=$" + d.value.toFixed(2))
    .join(", ");

  document.getElementById("chip-loading").style.display = "block";

  fetch("/api/chip-counter", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      imageBase64: base64,
      chipValues
    })
  })
  .then(r => r.json())
  .then(data => {
    document.getElementById("chip-loading").style.display = "none";
    document.getElementById("result").textContent = JSON.stringify(data, null, 2);
  })
  .catch(err => {
    document.getElementById("chip-loading").style.display = "none";
    alert("Scan failed");
    console.error(err);
  });
}
</script>
</body>
</html>
